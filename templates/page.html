{% extends "base.html" %}

{% block seo -%}
  {{ super() }}

  {%- set og_title = page.title -%}

  {% if config.title and page.title -%}
    {% set title = page.title ~ " | " ~ config.title -%}
  {% elif page.title -%}
    {% set title = page.title -%}
  {% elif config.title -%}
    {% set title = config.title -%}
  {% else -%}
    {% set title = "" -%}
  {% endif -%}

  {% if page.description -%}
    {% set description = page.description -%}
  {% endif -%}

  {% if page.extra.image -%}
    {% set image = page.extra.image -%}
  {% endif -%}

  {% if page.extra.image_height -%}
    {% set image_height = page.extra.image_height -%}
  {% endif -%}

  {% if page.extra.image_width -%}
    {% set image_width = page.extra.image_width -%}
  {% endif -%}

  {% set web_type = "BlogPosting" -%}
  
  {{ macros::seo(title=title, og_title=og_title, description=description, site_url=site_url, image=image, image_height=image_height, image_width=image_width, web_type=web_type) }}
  
  <!-- Preload blog post hero image if available -->
  {% if page.extra.static_thumbnail %}
  <link rel="preload" as="image" href="{{ get_url(path=page.extra.static_thumbnail) | safe }}" fetchpriority="high">
  {% endif %}
{%- endblock seo %}

{% block content %}
  <article class="post">
    <a href="{{ get_url(path='writing') | safe }}" class="back-to-blog">← back</a>
    <small class="post-meta">
      <time datetime="{{ page.date }}">
        {{ page.date | date(format="%b %d, %Y") }}<span class="meta-sep"> · </span>{{ page.reading_time }} min read
      </time>
      <span class="found-typo">
        {% set url = config.extra.repo_content_url ~ page.relative_path %}
        <a href="{{ url }}" target="_blank" aria-label="Edit this page on GitHub to submit a pull request" title="Edit on GitHub">suggest edit</a>
      </span>
    </small>
    <h1 class="post-title">{{ page.title }}</h1>
    {% if page.extra.subtitle %}
    <h2 class="post-subtitle">{{ page.extra.subtitle }}</h2>
    {% endif %}
    {% if page.taxonomies.tags %}
    <div class="post-tags">
      {% for tag in page.taxonomies.tags %}
        <span class="tag-pill">{{ tag | upper }}</span>
      {% endfor %}
    </div>
    {% endif %}

    {{ page.content | safe }}

    {% if page.earlier or page.later %}
    <nav class="post-nav" aria-label="Post navigation">
      {% if page.earlier %}
      <a href="{{ page.earlier.permalink | safe }}" class="post-nav-link" rel="prev">
        <span class="post-nav-label">← Older</span>
        <span class="post-nav-title">{{ page.earlier.title }}</span>
      </a>
      {% else %}<div class="flex-1"></div>{% endif %}

      {% if page.later %}
      <a href="{{ page.later.permalink | safe }}" class="post-nav-link" style="text-align:right;" rel="next">
        <span class="post-nav-label">Newer →</span>
        <span class="post-nav-title">{{ page.later.title }}</span>
      </a>
      {% endif %}
    </nav>
    {% endif %}
  </article>
{% endblock content %}
